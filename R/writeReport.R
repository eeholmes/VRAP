#' @title WriteReport
#' @description Create a pdf with basic information about the VRAP output. 
#' @details knit2pdf is used to create the pdf using Report-knitr-ER.xRnw or Report-knitr-Pop.xRnw (Sweave files) in inst/doc.
#' @param InFile the .rav input file.
#' @param OutFileBase basename to give the outputfiles.
#' @param show.file Whether to open the pdf after it is produced.
#' @return Nothing. The pdf is made and saved.
WriteReport=function(InFile=NULL, OutFileBase=NULL, show.file=FALSE){
  #READ INPUT DATA AND CALCULATE AEQs
  #direct from .rav file or simple calculation from rav file inputs
  inputs=GetInput(InFile)
  if(is.null(OutFileBase)){
    tmp=strsplit(InFile,"\\\\")[[1]]
    InFileBase=tmp[length(tmp)]
    tmp=strsplit(InFileBase,"/")[[1]]
    InFileBase=tmp[length(tmp)]   
    if(str_detect(InFileBase,"[.]")){
      OutFileBase=strsplit(InFileBase,"[.]")[[1]][1]; 
    }else{
      OutFileBase=InFileBase;
    }
  }
  
  #add the output file names to the inputs
  inputs = SetOutFileNames(OutFileBase, inputs, PathName=paste(getwd(),"/",sep=""))
  
  output.file = inputs$OutFileReport
  
  
  if(str_sub(output.file,-4)==".pdf") output.file=str_sub(inputs$OutFileReport,1,-5)
  pkgpath <- find.package("VRAP")
  if(inputs$StepFunc=="ER") path=file.path(pkgpath, "doc", "Report-knitr-ER.xRnw")  
  knit2pdf(path, output=paste(output.file,".tex",sep=""), envir=sys.nframe(), quiet=TRUE)
  if(show.file) file.show(paste(output.file,".pdf",sep=""))
  
}